!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e=e||self).fabric={},e.THREE)}(this,function(e,D){"use strict";var n,a,s,r,O={fut:1,padding:20,depth:.01,width:30,length:60,height:16,pitch:1,pitch_calc:5,o_sides:0,o_end:0,wainscot:!1,wainscotHeight:4,gutter:!1,wainscotColor:"#d8e5e6",wallColor:"#8a7967",roofColor:"#d8e5e6",trimColor:"#4b3d2a",ventColor:"#d8e5e6",rollupColor:"#d8e5e6",doorColor:"#cccccc",windowColor:"#00B8D9",isChangeColor:!1,girtColor:"#ff3300",limits:{width:[5,60],length:[5,200],height:[5,24],pitch:[1,5],o_sides:[0,5],o_end:[0,5]},limitsLean:{width:[6,25],pitch:[1,5],drop:[1,20],cut1:[0,50],cut2:[0,50]},holes:{front:{},back:{},left:{},right:{}},overhang:{front:{enable:!1,width:15,pitch:1,drop:2,cut1:0,cut2:0},back:{enable:!1,width:15,pitch:1,drop:2,cut1:0,cut2:0},left:{enable:!1,width:15,pitch:1,drop:2,cut1:0,cut2:0},right:{enable:!1,width:15,pitch:1,drop:2,cut1:0,cut2:0}},spread:!1,vent:"none",viewPreset:!1,viewScene:"default",isUpdateScene:!0,views:{car:!1,person:!1},accessories:!1,isUpdateAccessories:!1,newHole:!1,removeHole:!1,setState:function(e,t){if("object"==typeof e)if(void 0!==this[e.type]&&"removeHole"!=e.type){if("width"==e.type||"height"==e.type||"length"==e.type||"pitch"==e.type||"o_sides"==e.type||"o_end"==e.type){var o=parseInt(e.value);void 0!==this.limits[e.type]&&(o<this.limits[e.type][0]?o=this.limits[e.type][0]:o>this.limits[e.type][1]&&(o=this.limits[e.type][1])),"pitch"==e.type?this[e.type]=o/this.fut/2:this[e.type]=o/this.fut,"function"==typeof t&&t(o),this.needsUpdate=!0}else"viewPreset"==e.type?this[e.type]=e.value:"viewScene"==e.type?(this[e.type]=e.value,this.isUpdateScene=!0):(this[e.type]=e.value,this.needsUpdate=!0);console.log(O)}else{if("hole"==e.type)this.holes[e.wall][e.id]=e.value,this.needsUpdate=!0;else if("addHole"==e.type)this.newHole={wall:e.wall,size:e.value,name:e.name,callback:e.callback},this.needsUpdate=!0;else if("removeHole"==e.type)this.removeHole={id:e.value,callback:e.callback},this.needsUpdate=!0;else if("set-lean-to"==e.type){o=parseInt(e.value);void 0!==this.limitsLean[e.name]?(o<this.limitsLean[e.name][0]?o=this.limitsLean[e.name][0]:o>this.limitsLean[e.name][1]&&(o=this.limitsLean[e.name][1]),"pitch"==e.name?this.overhang[e.wall][e.name]=o/2:this.overhang[e.wall][e.name]=o):this.overhang[e.wall][e.name]=e.value,"function"==typeof t&&t(o),this.needsUpdate=!0}else"setColor"==e.type?(this[e.name]="#"+e.value,"trimColor"!=e.name&&"rollupColor"!=e.name||(this.isChangeColor=!0),this.needsUpdate=!0):"addModel"==e.type&&(!1===this.views[e.value]?this.views[e.value]=!0:!0===this.views[e.value]&&(this.views[e.value]=!1),"function"==typeof t&&t({type:e.value,status:this.views[e.value]}),this.isUpdateAccessories=!0);console.log(O)}return this},getScene:function(){console.log(this.scene.toJSON())},scene:null,group:null,texture:null,holeGroup:null,baseUrl:"http://bydenis.com/fabric/build",controls:!0,needsUpdate:!0},t=function(e){var h=new D.Group,t=new D.TextureLoader,o=new D.PlaneBufferGeometry(2e3,2e3,32),i=new D.MeshStandardMaterial,n=new D.Mesh(o,i);if(n.position.y=-.1,n.rotateX(-Math.PI/2),h.add(n),"default"==O.viewScene||"west_texas"==O.viewScene||"east_texas"==O.viewScene){var a=document.getElementById("vertexShader").textContent,s=document.getElementById("fragmentShader").textContent,r={topColor:{value:new D.Color(30719)},bottomColor:{value:new D.Color(16777215)},offset:{value:33},exponent:{value:.7}},l=new D.SphereGeometry(500,32,15),d=new D.ShaderMaterial({vertexShader:a,fragmentShader:s,uniforms:r,side:D.BackSide}),c=new D.Mesh(l,d);if(h.add(c),"west_texas"==O.viewScene)(t=new D.TextureLoader).load(O.baseUrl+"/source/mountains.jpg",function(e){e.wrapS=e.wrapT=D.RepeatWrapping;e.repeat.set(6.4,6.4),i.map=e,i.needsUpdate=!0});else t.load(O.baseUrl+"/source/grass.jpg",function(e){e.wrapS=e.wrapT=D.RepeatWrapping,e.repeat.set(5/1865*8e3*4,5/1865*8e3*4),i.map=e,i.needsUpdate=!0})}else if("mountains"==O.viewScene){(t=new D.TextureLoader).load(O.baseUrl+"/source/mountains.jpg",function(e){e.wrapS=e.wrapT=D.RepeatWrapping;e.repeat.set(6.4,6.4),i.map=e,i.needsUpdate=!0}),e.background=(new D.CubeTextureLoader).setPath(O.baseUrl+"/source/mountains/").load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"])}"east_texas"==O.viewScene&&(new D.ObjectLoader).load(O.baseUrl+"/source/tree1.json",function(e){var t=e.clone();t.position.set(-40,0,-30),t.scale.set(1.5,1.5,1.5),h.add(t);var o=e.clone();o.position.set(-45,0,10),o.scale.set(1.8,1.8,1.8),h.add(o);var i=e.clone();i.position.set(-38,0,5),i.scale.set(.5,.5,.5),h.add(i);var n=e.clone();n.position.set(-39,0,20),n.scale.set(1.3,1.3,1.3),h.add(n);var a=e.clone();a.position.set(45,0,8),a.scale.set(1.8,1.8,1.8),h.add(a);var s=e.clone();s.position.set(40,0,-30),s.scale.set(1.3,1.3,1.3),h.add(s);var r=e.clone();r.position.set(38,0,20),r.scale.set(.5,.5,.5),h.add(r);var l=e.clone();l.position.set(45,0,-20),l.scale.set(.5,.5,.5),h.add(l);var d=e.clone();d.position.set(41,0,25),d.scale.set(.9,.9,.9),h.add(d);var c=e.clone();c.position.set(44,0,40),c.scale.set(1.9,1.9,1.9),h.add(c)});e.remove(O.groupLand),e.add(h),O.groupLand=h,O.isUpdateScene=!1},R=function(a){a.faceVertexUvs[0]=[],a.faces.forEach(function(o){var e=["x","y","z"].sort(function(e,t){return Math.abs(o.normal[e])>Math.abs(o.normal[t])}),t=a.vertices[o.a],i=a.vertices[o.b],n=a.vertices[o.c];a.faceVertexUvs[0].push([new D.Vector2(t[e[0]],t[e[1]]),new D.Vector2(i[e[0]],i[e[1]]),new D.Vector2(n[e[0]],n[e[1]])])}),a.uvsNeedUpdate=!0},Z=function(t,o,i,e){var n=O.wallColor;void 0!==e&&(n=e);var a=new D.MeshStandardMaterial({color:n});return a.side=D.DoubleSide,(new D.TextureLoader).load(O.baseUrl+"/source/NormalMap.jpg",function(e){e.wrapS=e.wrapT=D.RepeatWrapping,e.anisotropy=1,a.bumpScale=(void 0!==i&&-1!=i?(e.rotation=i,e.repeat.set(10*o/4/3.1*O.fut,t/30*40/100*O.fut)):e.repeat.set(t/30*40/1.5*O.fut,10*o/2*O.fut),.04),a.normalMap=e,a.normalScale=new D.Vector2(.3,1),a.needsUpdate=!0,e.needsUpdate=!0}),a},A=function(r){var l=O.length+2*O.depth+O.o_end,d=new D.MeshBasicMaterial({color:O.trimColor});d.side=D.DoubleSide;var c=.05,h=new D.ObjectLoader;h.load(O.baseUrl+"/source/trim1.json",function(e){var t=60.911766052246094,o=new D.Mesh(e.geometry.clone(),d),n=O.skew+O.depth/2+O.o_sides;if("roofLeft"==r.name)(i=o.clone()).scale.set(3,3,l/t),i.position.z=-l/2,i.position.x=-n/2-.3,i.rotateY(Math.PI),(a=o.clone()).scale.set(3,3,(n-c)/t),a.rotateY(-Math.PI/2),a.position.x=-(n-c)/2,a.position.z=l/2+.3,(s=o.clone()).scale.set(3,3,(n-c)/t),s.rotateY(Math.PI/2),s.position.x=(n-c)/2,s.position.z=-l/2-.3,h.load(O.baseUrl+"/source/trimAngel.json",function(e){var t=new D.Mesh(e.geometry.clone(),d);t.scale.set(3,3,3);var o=t.clone();o.position.x=-n/2-.1,o.position.z=l/2+.09,o.rotateY(-Math.PI/2),r.add(o);var i=t.clone();i.position.x=-n/2-.2,i.position.z=-l/2-.05,i.rotateY(Math.PI),r.add(i)});else if("roofRight"==r.name){var i,a,s;(i=o.clone()).scale.set(3,3,l/t),i.position.z=l/2,i.position.x=n/2+.3,(a=o.clone()).scale.set(3,3,(n-c)/t),a.rotateY(-Math.PI/2),a.position.x=-(n-c)/2,a.position.z=l/2+.3,(s=o.clone()).scale.set(3,3,(n-c)/t),s.rotateY(Math.PI/2),s.position.x=(n-c)/2,s.position.z=-l/2-.3,h.load(O.baseUrl+"/source/trimAngel.json",function(e){var t=new D.Mesh(e.geometry.clone(),d);t.scale.set(3,3,3);var o=t.clone();o.position.x=n/2+.2,o.position.z=l/2,r.add(o);var i=t.clone();i.position.x=n/2+.11,i.position.z=-l/2-.09,i.rotateY(Math.PI/2),r.add(i)})}r.add(i),r.add(a),r.add(s)})},N=function(c){var h=new D.MeshStandardMaterial({color:O.girtColor});h.side=D.DoubleSide;var p=2.6243999004364014,u=.2-.08,v=function(e,t){var o=e.clone();return o.position.y+=t,o},w=function(e,t){var o=e.clone();return o.position.x+=t,o};(new D.ObjectLoader).load(O.baseUrl+"/source/girt.json",function(e){e.position.set(0,0,0),e.material=h;var t=e.clone(e);if(e.scale.set(1,1,O.length/p),t.scale.set(1,1,O.width/p),"roofLeft"==c.name){var o=Math.ceil((O.skew+O.depth/2-1)/4);(n=e.clone()).rotateZ(Math.PI/2),n.position.x=(O.skew+O.depth/2)/2+3,n.position.y=-u;for(var i=1;i<o;i++)c.add(w(n,4*-i));c.add(w(n,-O.skew+O.depth/2+u))}else if("roofRight"==c.name){var n;o=Math.ceil((O.skew+O.depth/2-1)/4);(n=e.clone()).rotateZ(-Math.PI/2),n.position.x=-(O.skew+O.depth/2)/2-3,n.position.y=-u;for(i=1;i<o;i++)c.add(w(n,4*i));c.add(w(n,O.skew+O.depth/2-u))}else if(5<O.height){var a=Math.ceil(O.height/4),s=e.clone();s.position.x=-O.width/2+u;var r=e.clone();r.rotateY(Math.PI),r.position.x=O.width/2-u;var l=t.clone();l.rotateY(Math.PI/2),l.position.z=O.length/2-u;var d=t.clone();d.rotateY(-Math.PI/2),d.position.z=-O.length/2+u;for(i=1;i<a;i++)c.add(v(s,4*i)),c.add(v(r,4*i)),c.add(v(l,4*i)),c.add(v(d,4*i))}})},W=function(e,t){var o=e.clone();return o.position.z+=t,o},o=function(e){O.pitch_calc=O.width/12*O.pitch,O.skew=Math.sqrt(O.pitch_calc*O.pitch_calc+O.width/2*O.width/2);var t=O.pitch_calc/O.skew;O.rotate_angel=Math.asin(t)/Math.PI*180*Math.PI/180;var o={depth:O.depth,bevelEnabled:!1,steps:1},i=new D.Shape;i.moveTo(-O.width/2,0),i.lineTo(O.width/2,0),i.lineTo(O.width/2,O.height),i.lineTo(0,O.height+O.pitch_calc),i.lineTo(-O.width/2,O.height),i.lineTo(-O.width/2,0);var n=i.clone(),a=new D.Shape;a.moveTo(-O.width/2,0),a.lineTo(O.width/2,0),a.lineTo(O.width/2,O.wainscotHeight),a.lineTo(-O.width/2,O.wainscotHeight),a.lineTo(-O.width/2,0);var s=a.clone();for(var r in O.holes.front){i.holes.push(O.holes.front[r]);for(var l=O.holes.front[r].clone(),d=!1,c=0;c<l.curves.length;c++)(l.curves[c].v1.y<O.wainscotHeight||l.curves[c].v2.y<O.wainscotHeight)&&(d=!0),l.curves[c].v1.y>O.wainscotHeight&&(l.curves[c].v1.y=O.wainscotHeight),l.curves[c].v2.y>O.wainscotHeight&&(l.curves[c].v2.y=O.wainscotHeight);!0===d&&a.holes.push(l)}for(var r in O.holes.back){n.holes.push(O.holes.back[r]);for(l=O.holes.back[r].clone(),d=!1,c=0;c<l.curves.length;c++)(l.curves[c].v1.y<O.wainscotHeight||l.curves[c].v2.y<O.wainscotHeight)&&(d=!0),l.curves[c].v1.y>O.wainscotHeight&&(l.curves[c].v1.y=O.wainscotHeight),l.curves[c].v2.y>O.wainscotHeight&&(l.curves[c].v2.y=O.wainscotHeight);!0===d&&s.holes.push(l)}var h=new D.ExtrudeGeometry(i,o);h.uvsNeedUpdate=!0,R(h);var p=new D.ExtrudeGeometry(n,o);p.uvsNeedUpdate=!0,R(p);var u=new D.Mesh(h,Z(1,1));u.name="wallFront",u.position.z=O.length/2;var v=new D.Mesh(p,Z(1,1));if(u.name="wallBack",v.position.z=-O.length/2-O.depth,!0===O.wainscot){var w=new D.ExtrudeGeometry(a,o);w.uvsNeedUpdate=!0,R(w);var g=new D.Mesh(w,Z(1,1,-1,O.wainscotColor));g.name="wainscotFront",g.position.z=.01,u.add(g);var f=new D.ExtrudeGeometry(s,o);f.uvsNeedUpdate=!0,R(f);var b=new D.Mesh(f,Z(1,1,-1,O.wainscotColor));b.name="wainscotBack",b.position.z=-.01,v.add(b)}var m=new D.BoxGeometry(O.width,O.depth,O.length),y=new D.Mesh(m,new D.MeshStandardMaterial({color:13421772}));y.name="floor",y.position.y=O.depth/2;var M=new D.Shape;M.moveTo(-O.length/2,0),M.lineTo(O.length/2,0),M.lineTo(O.length/2,O.height),M.lineTo(-O.length/2,O.height),M.lineTo(-O.length/2,0);var x=M.clone(),j=new D.Shape;j.moveTo(-O.length/2,0),j.lineTo(O.length/2,0),j.lineTo(O.length/2,O.wainscotHeight),j.lineTo(-O.length/2,O.wainscotHeight),j.lineTo(-O.length/2,0);var z=j.clone();for(var r in O.holes.left){M.holes.push(O.holes.left[r]);for(l=O.holes.left[r].clone(),d=!1,c=0;c<l.curves.length;c++)(l.curves[c].v1.y<O.wainscotHeight||l.curves[c].v2.y<O.wainscotHeight)&&(d=!0),l.curves[c].v1.y>O.wainscotHeight&&(l.curves[c].v1.y=O.wainscotHeight),l.curves[c].v2.y>O.wainscotHeight&&(l.curves[c].v2.y=O.wainscotHeight);!0===d&&j.holes.push(l)}for(var r in O.holes.right){x.holes.push(O.holes.right[r]);for(l=O.holes.right[r].clone(),d=!1,c=0;c<l.curves.length;c++)(l.curves[c].v1.y<O.wainscotHeight||l.curves[c].v2.y<O.wainscotHeight)&&(d=!0),l.curves[c].v1.y>O.wainscotHeight&&(l.curves[c].v1.y=O.wainscotHeight),l.curves[c].v2.y>O.wainscotHeight&&(l.curves[c].v2.y=O.wainscotHeight);!0===d&&z.holes.push(l)}var S=new D.ExtrudeGeometry(M,o);S.uvsNeedUpdate=!0,R(S);var P=new D.Mesh(S,Z(1,1));P.name="wallLeft",P.rotateY(Math.PI/2),P.position.x=-O.width/2+O.depth/2;var I=new D.ExtrudeGeometry(x,o);I.uvsNeedUpdate=!0,R(I);var U=new D.Mesh(I,Z(1,1));if(U.name="wallRight",U.rotateY(Math.PI/2),U.position.x=O.width/2-O.depth/2,!0===O.wainscot){var H=new D.ExtrudeGeometry(j,o);H.uvsNeedUpdate=!0,R(H);var k=new D.Mesh(H,Z(1,1,-1,O.wainscotColor));k.name="wainscotLeft",k.position.z=-.01,P.add(k);var C=new D.ExtrudeGeometry(z,o);C.uvsNeedUpdate=!0,R(C);var G=new D.Mesh(C,Z(1,1,-1,O.wainscotColor));G.name="wainscotRight",G.position.z=.01,U.add(G)}var L=new D.BoxGeometry(O.skew+O.depth/2+O.o_sides,O.depth,O.length+2*O.depth+O.o_end),T=new D.Mesh(L,Z(O.skew+O.depth/2+O.o_sides,O.length+2*O.depth+O.o_end,Math.PI/2,O.roofColor)),_=T.clone();_.name="roofLeft",_.position.x=-O.o_sides/2,A(_),N(_);var B=new D.Group;B.name="roofLeftGroup",B.rotateZ(O.rotate_angel),B.position.y=O.height+O.pitch_calc/2+O.depth/2,B.position.x=-O.width/2/2,B.add(_);var Y=T.clone();Y.name="roofRight",Y.position.x=O.o_sides/2,A(Y),N(Y);var E=new D.Group;E.name="roofRightGroup",E.rotateZ(-O.rotate_angel),E.position.y=O.height+O.pitch_calc/2+O.depth/2,E.position.x=O.width/2/2,E.add(Y),e.add(B),e.add(E),e.add(P),e.add(U),e.add(y),e.add(v),e.add(u),function(p,u,v){var w=new D.MeshStandardMaterial({color:O.girtColor});w.side=D.DoubleSide;var g=.12,f=Math.floor((O.length-1)/25),b=new D.ObjectLoader;b.load(O.baseUrl+"/source/gritVertical.json",function(e){e.position.set(0,0,0),e.material=w;var t=e.clone();if(e.scale.set(O.height/6.08,2,2),e.rotateZ(Math.PI/2),t.scale.set((O.height+O.pitch_calc-.1)/6.08,2,2),t.rotateZ(Math.PI/2),20<O.width){t.position.y=(O.height+O.pitch_calc-.1)/2-.01;var o=t.clone();o.position.z=-O.length/2+g;var i=t.clone();i.rotateY(Math.PI),i.position.z=O.length/2-g,p.add(o),p.add(i)}var n=e.clone();n.position.y=O.height/2-.01,n.position.x=-O.width/2+g,n.rotateX(Math.PI/2);var a=n.clone();a.position.z=O.length/2-.24,p.add(a);var s=n.clone();if(s.position.z=-O.length/2+.24,p.add(s),1==f)p.add(W(n,0));else for(var r=0;r<f;r++){var l=25*r-(O.length/4+.48*r);p.add(W(n,l))}var d=n.clone();d.rotateX(Math.PI),d.position.x=O.width/2-g;var c=d.clone();c.position.z=O.length/2-.24,p.add(c);var h=d.clone();if(h.position.z=-O.length/2+.24,p.add(h),1==f)p.add(W(d,0));else for(r=0;r<f;r++)l=25*r-(O.length/4+.48*r),p.add(W(d,l));b.load(O.baseUrl+"/source/beam.json",function(e){e.position.set(0,-.32,0),e.scale.set(2,(O.skew-.32)/3.4723,2),e.material=w,e.rotateZ(Math.PI/2),e.rotateY(Math.PI/2);var t=e.clone();t.rotateZ(Math.PI),t.position.x=.05*O.pitch_calc+.2+O.o_sides/2;var o=e.clone();o.position.x=-.05*O.pitch_calc-.2-O.o_sides/2;var i=t.clone();i.position.z=O.length/2-.2,u.add(i);var n=t.clone();n.position.z=-O.length/2+.2,u.add(n);var a=o.clone();a.position.z=O.length/2-.2,v.add(a);var s=o.clone();if(s.position.z=-O.length/2+.2,v.add(s),1==f)u.add(W(t,0));else for(var r=0;r<f;r++){var l=25*r-(O.length/4+.48*r);u.add(W(t,l))}if(1==f)v.add(W(o,0));else for(r=0;r<f;r++)l=25*r-(O.length/4+.48*r),v.add(W(o,l))})})}(e,_,Y),N(e)},l=function(e){if("function"==typeof e){for(var t=new Array,o=0;o<O.holeGroup.children.length;o++)t.push({name:O.holeGroup.children[o].name,id:O.holeGroup.children[o].uuid});e(t)}},i=function(e){var o=new D.Group;o.position.y=O.height+O.pitch_calc+.01;var i=O.length+2*O.depth+O.o_end,t=new D.MeshStandardMaterial({color:O.roofColor});t.side=D.BackSide;var n=new D.MeshBasicMaterial({color:O.trimColor});n.side=D.DoubleSide;var a=new D.ObjectLoader;a.load(O.baseUrl+"/source/peakRoll.json",function(e){e.position.set(0,0,0),e.material=t;e.scale.set(3,3,i/.30480000376701355),o.add(e)}),a.load(O.baseUrl+"/source/peakBox.json",function(e){e.position.set(0,.2,i/2),e.material=n,e.scale.set(3,3,3);var t=e.clone();t.position.set(0,.2,-i/2),t.rotateY(Math.PI),o.add(e),o.add(t)}),function(s,r){if("standard"==O.vent||"low"==O.vent){var l=new D.MeshStandardMaterial({color:O.ventColor});l.side=D.DoubleSide,(new D.ObjectLoader).load(O.baseUrl+"/source/vent4-"+O.vent+".json",function(e){if(e.material=l,e.position.set(0,.31,0),!0===O.spread){e.scale.set(2,2,1.65);for(var t=new D.Group,o=Math.ceil((r-1)/25),i=r/o,n=0;n<o;n++){var a=e.clone();a.position.z=i*n,t.add(a)}t.position.z=-i*(o-1)/2,s.add(t)}else e.scale.set(2,2,r/5.971586227416992-2*O.depth),s.add(e)})}}(o,i),e.add(o)},w=function(e,t){var o=e.clone();return o.position.z+=t,o},g=function(n,a,s,r,l){if(!0===O.gutter){var d=new D.MeshBasicMaterial({color:O.trimColor});d.side=D.DoubleSide;var e=new D.ObjectLoader;e.load(O.baseUrl+"/source/gutterProfile.json",function(i){e.load(O.baseUrl+"/source/gutterKickout.json",function(e){var t=new D.Group;i.material=d,i.position.set(0,n,0),i.scale.set(3,3.3*(n-1),3),t.add(i),e.material=d,e.position.set(0,1,-.3),e.rotateY(-Math.PI/2),e.scale.set(3,3,3),t.add(e),void 0!==s&&t.rotateY(s),void 0!==r&&(t.position.z=r);var o=new D.Group;o.add(t),"function"==typeof a&&a(o),"object"==typeof l&&"add"==l.name&&l.add(o)})})}},f=function(e,t){var o=e.clone();return o.position.z+=t,o},d=function(e,t,o){var i=new D.Group,n=new D.Group,a=t,s=e.width,r=o-e.drop,l=new D.BoxGeometry(a-e.cut1-e.cut2,O.depth,s),d=new D.Mesh(l,Z(a-e.cut1-e.cut2,s,-1,O.roofColor));d.position.z=s/2;var c=s/12*e.pitch,h=Math.sqrt(c*c+s*s),p=(Math.sqrt(h*h-c*c),c/h),u=Math.asin(p)/Math.PI*180*Math.PI/180,v=new D.Group;return v.rotateX(u),v.position.y=r-2*O.depth,v.add(d),function(r,l,d){var c=new D.MeshBasicMaterial({color:O.trimColor});c.side=D.DoubleSide;var h=new D.ObjectLoader;h.load(O.baseUrl+"/source/trim1.json",function(e){var t=60.911766052246094,o=new D.Mesh(e.geometry.clone(),c),n=new D.Group,i=o.clone();i.scale.set(3,3,l/t),i.position.z=-l/2,i.position.x=-d/2-.2,i.rotateY(Math.PI);var a=o.clone();a.scale.set(3,3,(d-.05)/t),a.rotateY(-Math.PI/2),a.position.x=-(d-.05)/2,a.position.z=l/2+.1;var s=o.clone();s.scale.set(3,3,(d-.05)/t),s.rotateY(Math.PI/2),s.position.x=(d-.05)/2,s.position.z=-l/2-.1,h.load(O.baseUrl+"/source/trimAngel.json",function(e){var t=new D.Mesh(e.geometry.clone(),c),o=t.clone();o.position.x=-d/2-.1,o.position.z=l/2+.09,o.rotateY(-Math.PI/2),n.add(o);var i=t.clone();i.position.x=-d/2-.2,i.position.z=-l/2-.05,i.rotateY(Math.PI),n.add(i)}),n.add(i),n.add(a),n.add(s),n.rotateY(Math.PI/2),r.add(n)})}(d,a-e.cut1-e.cut2,s),function(n,r,l,d,e){var c=new D.MeshStandardMaterial({color:O.girtColor});c.side=D.DoubleSide;var a=function(e,t){var o=e.clone();return o.position.x+=t,o},h=new D.Group,s=new D.ObjectLoader;s.load(O.baseUrl+"/source/girt.json",function(e){e.position.set(0,0,0),e.material=c,e.scale.set(1,1,r/2.6243999004364014);var t=Math.ceil((l+O.depth/2-1)/4),o=e.clone();o.rotateZ(Math.PI/2),o.position.x=(l+O.depth/2)/2,o.position.y=-(.2-.08);for(var i=1;i<t;i++)h.add(a(o,4*-i));h.add(a(o,(.2-.08)/2-l)),s.load(O.baseUrl+"/source/beam.json",function(e){e.position.set(0,-.32,0),e.scale.set(2,(l-.4)/3.4723,2),e.material=c,e.rotateZ(Math.PI/2),e.rotateY(Math.PI/2);var t=e.clone();t.position.x=-.02*d-.2;var o=t.clone();o.position.z=r/2-.2,h.add(o);var i=t.clone();i.position.z=-r/2+.2,h.add(i);var n=Math.floor((r-1)/20);if(1==n)h.add(w(t,0));else{for(var a=new D.Group,s=0;s<n;s++)a.add(w(t,20*s));h.add(a),a.position.z=-20*n/2/2}}),h.rotateY(Math.PI/2),n.add(h)})}(d,a-e.cut1-e.cut2,s,c),function(e,s,r,l,d,t,c,o){var h=new D.MeshStandardMaterial({color:O.girtColor});h.side=D.DoubleSide;var p=Math.floor((s-1)/20),i=new D.ObjectLoader,u=new D.Group;i.load(O.baseUrl+"/source/colon.json",function(e){e.position.set(0,0,.15),e.material=h,e.scale.set(3,(d-l-.2)/.3,3),e.rotateZ(-c),e.position.y=-.2,e.position.x=-r/2+.4;var t=e.clone();t.position.z=-s/2+.3,u.add(t),g(d-l-.5,function(e){e.position.y=-.29,e.position.x=-.2,e.scale.set(1/3,1/((d-l-.2)/.3),1/3),t.add(e)},-Math.PI/2);var o=e.clone();if(o.position.z=s/2,u.add(o),g(d-l-.5,function(e){e.position.y=-.29,e.position.x=-.2,e.scale.set(1/3,1/((d-l-.2)/.3),1/3),o.add(e)},-Math.PI/2),1==p){var i=f(e,0);u.add(i),g(d-l-.5,function(e){e.position.y=-.29,e.position.x=-.2,e.scale.set(1/3,1/((d-l-.2)/.3),1/3),i.add(e)},-Math.PI/2)}else{for(var n=new D.Group,a=0;a<p;a++)(i=f(e,20*a)).name="add",n.add(i),g(d-l-.5,function(e){e.position.y=-.29,e.position.x=-.2,e.scale.set(1/3,1/((d-l-.2)/.3),1/3)},-Math.PI/2,0,i);u.add(n),n.position.z=-20*p/2/2}}),u.rotateY(Math.PI/2),e.add(u)}(d,a-e.cut1-e.cut2,s,c,r,0,u,e.pitch),n.add(v),n.position.x=-e.cut1/2+e.cut2/2,i.add(n),i},c=function(c,e){new D.MeshBasicMaterial({color:O.trimColor}).side=D.DoubleSide;var h=new D.Group;return g(e,function(e){for(var t=new D.Group,o=c-24,i=Math.ceil((o-1)/25),n=o/i,a=0;a<i;a++){var s=e.clone();s.position.x=n*a,t.add(s)}var r=-n*(i-1)/2;t.position.x=r;var l=e.clone();l.position.x=-c/2-r+2,t.add(l);var d=e.clone();d.position.x=c/2-r-2,t.add(d),h.add(t)}),h},h=function(e){var s,r,t=new D.Group;!function(){if(!1!==O.newHole&&void 0!==O.newHole.size){var n=O.newHole.size.split("_");n[1]=parseInt(n[1]),n[2]=parseInt(n[2]);var e=new D.BoxGeometry(n[1]+.6,n[2]+.6,.8),t=new D.BoxGeometry(n[1],n[2],.01),o=new D.MeshStandardMaterial({color:14145495});o.side=D.DoubleSide,o.transparent=!0,o.opacity=0,o.alphaTest=.1;var a=new D.Mesh(e,o),i=o.clone(),s=new D.Mesh(t,i);switch(s.position.set(0,0,.04),a.wall=O.newHole.wall,a.design=n[0],a.sizeHole=O.newHole.size,a.name=O.newHole.name,"w"==a.design?a.position.y=5:a.position.y=n[2]/2,a.wall){case"front":a.position.z=O.length/2+O.depth/2;break;case"back":a.position.z=-O.length/2-O.depth/2;break;case"left":a.rotateY(Math.PI/2),a.position.x=-O.width/2-O.depth/2;break;case"right":a.rotateY(Math.PI/2),a.position.x=O.width/2+O.depth/2}"w"==n[0]?(i.color.set(O.windowColor),i.opacity=.3,i.needsUpdate=!0,a.add(s)):"d"==n[0]&&(i.color.set(O.doorColor),i.opacity=1,i.needsUpdate=!0,s.position.set(0,0,.02),a.add(s)),(new D.ObjectLoader).load(O.baseUrl+"/source/"+O.newHole.size+".json",function(e){var t=.33*10;if(e.position.set(0,0,.05),"w"==n[0]||"d"==n[0])for(var o in e.children){var i=e.children[o];"front"==a.wall&&i.position.set(0,0,.05),"back"==a.wall&&i.position.set(0,0,.1),"left"==a.wall&&i.position.set(0,0,.05),"right"==a.wall&&i.position.set(0,0,.05),i.scale.set(t,t,t),i.material=new D.MeshStandardMaterial({color:O.trimColor}),a.add(i)}else if("r"==n[0])for(var o in e.position.set(0,0,.1),e.scale.set(8*t,8*t,.25*t/2),e.material=new D.MeshStandardMaterial({color:O.trimColor}),a.add(e),e.children)"white"==e.children[o].material.name||"panels"==e.children[o].material.name?e.children[o].material=new D.MeshStandardMaterial({color:O.rollupColor,side:D.DoubleSide,name:"white"}):"trim"==e.children[o].material.name&&(e.children[o].material=new D.MeshStandardMaterial({color:O.trimColor,side:D.DoubleSide}))}),O.holeGroup.add(a),l(O.newHole.callback),O.newHole=!1}}(),function(){if(!1!==O.removeHole&&void 0!==O.removeHole.id)for(var e=0;e<O.holeGroup.children.length;e++)O.holeGroup.children[e].uuid==O.removeHole.id&&(delete O.holes[O.holeGroup.children[e].wall][O.removeHole.id],O.holeGroup.remove(O.holeGroup.children[e]),e=O.holeGroup.children.length);l(O.removeHole.callback),O.removeHole=!1}(),function(){if(!0===O.isChangeColor)for(var e=0;e<O.holeGroup.children.length;e++)if(-1!==O.holeGroup.children[e].name.indexOf("Roll-Up"))for(var t in O.holeGroup.children[e].children[0].children)"white"==O.holeGroup.children[e].children[0].children[t].material.name&&(O.holeGroup.children[e].children[0].children[t].material=new D.MeshStandardMaterial({color:O.rollupColor,side:D.DoubleSide,name:"white"}));O.isChangeColor=!1}(),o(t),s=t,(r=new D.MeshBasicMaterial({color:O.trimColor})).side=D.DoubleSide,(new D.ObjectLoader).load(O.baseUrl+"/source/outsideAngel.json",function(e){var t=e.clone();t.position.set(0,0,0),t.material=r,t.scale.set(3,3,O.height/.30480000376701355);var o=t.clone();o.position.z=O.length/2,o.position.x=O.width/2;var i=t.clone();i.position.z=O.length/2,i.position.x=-O.width/2,i.rotateZ(-Math.PI/2);var n=t.clone();n.position.z=-O.length/2,n.position.x=O.width/2,n.rotateZ(Math.PI/2);var a=t.clone();a.position.z=-O.length/2,a.position.x=-O.width/2,a.rotateZ(Math.PI),s.add(o),s.add(i),s.add(n),s.add(a)}),i(t),function(e){var t;!0===O.overhang.front.enable&&((t=d(O.overhang.front,O.width,O.height)).position.z=O.length/2,e.add(t));!0===O.overhang.back.enable&&((t=d(O.overhang.back,O.width,O.height)).rotateY(Math.PI),t.position.z=-O.length/2,e.add(t));!0===O.overhang.left.enable&&((t=d(O.overhang.left,O.length,O.height)).rotateY(-Math.PI/2),t.position.x=-O.width/2,e.add(t));!0===O.overhang.right.enable&&((t=d(O.overhang.right,O.length,O.height)).rotateY(Math.PI/2),t.position.x=O.width/2,e.add(t))}(t),function(e){if(!0===O.gutter){var t;!0!==O.overhang.left.enable&&((t=c(O.length,O.height)).rotateY(-Math.PI/2),t.position.x=-O.width/2-.3,e.add(t)),!0!==O.overhang.right.enable&&((t=c(O.length,O.height)).rotateY(Math.PI/2),t.position.x=O.width/2+.3,e.add(t))}}(t),function(e){var t=O.width+O.padding,o=O.length+O.padding,i=0,n=0;!0===O.overhang.front.enable&&(o+=O.overhang.front.width,n+=O.overhang.front.width/2),!0===O.overhang.back.enable&&(o+=O.overhang.back.width,n-=O.overhang.back.width/2),!0===O.overhang.left.enable&&(t+=O.overhang.left.width,i-=O.overhang.left.width/2),!0===O.overhang.right.enable&&(t+=O.overhang.right.width,i+=O.overhang.right.width/2);var a=new D.BoxBufferGeometry(t,o,.1),s=new D.MeshStandardMaterial;s.transparent=!0,s.opacity=0,(new D.TextureLoader).load(O.baseUrl+"/source/areaBg.jpg",function(e){e.wrapS=e.wrapT=D.RepeatWrapping,s.opacity=.9,e.anisotropy=1,e.repeat.set(t/2048*1e3/8,o/1536*1e3/8),s.map=e,s.needsUpdate=!0,e.needsUpdate=!0});var r=new D.Mesh(a,s);r.position.x=i,r.position.z=n,r.position.y=-.05,r.rotateX(-Math.PI/2),e.add(r)}(t),O.scene.remove(O.group),O.scene.add(t),O.group=t,O.needsUpdate=!1,e()},p=function(e,t){switch(e){case"top":t.position.set(0,80,0);break;case"front":t.position.set(0,5,-O.length/2-20);break;case"back":t.position.set(0,5,O.length/2+20);break;case"left":t.position.set(-O.width/2-30,5,0);break;case"right":t.position.set(O.width/2+30,5,0);break;case"inside":t.position.set(0,5,O.length/2-5);break;case"front-left":t.position.set(-O.width/2-30,5,-O.length/2-20);break;case"front-right":t.position.set(O.width/2+30,5,-O.length/2-20);break;case"back-left":t.position.set(-O.width/2-30,5,O.length/2+20);break;case"back-right":t.position.set(O.width/2+30,5,O.length/2+20);break;case"zoomin":t.position.multiplyScalar(1.2);break;case"zoomout":t.position.multiplyScalar(.8)}O.viewPreset=!1},u=function(){if(!1!==O.accessories)for(var e=0;e<O.accessories.children.length;e++)void 0!==O.views[O.accessories.children[e].name]&&(!0===O.views[O.accessories.children[e].name]?O.accessories.children[e].visible=!0:O.accessories.children[e].visible=!1);O.isUpdateAccessories=!1};function v(){!1!==O.isUpdateScene&&t(a),!1!==O.viewPreset&&p(O.viewPreset,n),!0===O.isUpdateAccessories&&u(),!0===O.needsUpdate?h(function(){b()}):b()}function b(){r.update(),s.render(a,n),requestAnimationFrame(v)}e.init=function(){var t,e;(s=new D.WebGLRenderer({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),(n=new D.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e4)).position.y=1.1*O.height,n.position.z=1.1*O.length,n.position.x=O.width,a=new D.Scene,(O.scene=a).fog=new D.Fog(16777215,1,1e4),a.fog.color.setHSL(.6,0,1),window.addEventListener("resize",function(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)},!1),document.getElementById("canvas-fabric").appendChild(s.domElement),function(e){var t=new D.SpotLight(16777187,.8);t.position.set(-100,50,200),t.castShadow=!0,t.angle=Math.PI,t.penumbra=!0,e.add(t),new D.SpotLightHelper(t);var o=new D.SpotLight(16777215,.8);o.position.set(200,50,-200),o.angle=Math.PI,o.penumbra=!0,e.add(o);var i=new D.SpotLight(16777215,.4);i.position.set(-30,300,100),i.penumbra=!0,i.angle=Math.PI/4,e.add(i);var n=new D.AmbientLight(12176895,.2);n.position.set(5e3,5e3,5e3),e.add(n)}(a),(r=new D.OrbitControls(n,s.domElement)).screenSpacePanning=!0,r.target=new D.Vector3(0,3,0),r.enableDamping=!0,r.dampingFactor=.08,r.enableZoom=!0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI/2.1,r.minDistance=5,r.maxDistance=300,r.enablePan=!1,r.rotateSpeed=1.5,O.controls=r,O.accessories=(t=new D.Group,(e=new D.ObjectLoader).load(O.baseUrl+"/source/car.json",function(e){e.position.set(35,0,10),e.isHole=!1,e.scale.set(3.3,3.3,3.3),e.visible=!1,e.name="car",t.add(e)}),e.load(O.baseUrl+"/source/person.json",function(e){e.position.set(33,0,20),e.isHole=!1,e.scale.set(3.3,3.3,3.3),e.visible=!1,e.name="person",t.add(e)}),t),a.add(O.accessories);var o=new D.Group;O.holeGroup=o,a.add(o);var i=new D.DragControls([o,O.accessories],n,s.domElement);i.transformGroup=!1,i.addEventListener("dragstart",function(e){(r.enabled=!1)!==e.object.isHole&&(e.object.geometry.computeBoundingBox(),e.object.material.emissive.set(11184810),e.object.material.opacity=0)}),i.addEventListener("dragend",function(e){if(!(r.enabled=!0)!==e.object.isHole){e.object.material.emissive.set(0),e.object.material.opacity=0;var t=e.object.geometry.boundingBox.max.x-e.object.geometry.boundingBox.min.x-.6,o=e.object.geometry.boundingBox.max.y-e.object.geometry.boundingBox.min.y-.6,i=new D.Path;"left"==e.object.wall||"right"==e.object.wall?(i.moveTo(-e.object.position.z-t/2,e.object.position.y-o/2),i.lineTo(-e.object.position.z+t/2,e.object.position.y-o/2),i.lineTo(-e.object.position.z+t/2,e.object.position.y+o/2),i.lineTo(-e.object.position.z-t/2,e.object.position.y+o/2),i.lineTo(-e.object.position.z-t/2,e.object.position.y-o/2)):(i.moveTo(e.object.position.x-t/2,e.object.position.y-o/2),i.lineTo(e.object.position.x+t/2,e.object.position.y-o/2),i.lineTo(e.object.position.x+t/2,e.object.position.y+o/2),i.lineTo(e.object.position.x-t/2,e.object.position.y+o/2),i.lineTo(e.object.position.x-t/2,e.object.position.y-o/2)),i.pid=e.object.uuid,O.setState({type:"hole",value:i,obj:e.object,wall:e.object.wall,id:e.object.uuid})}}),i.addEventListener("drag",function(e){if(!1!==e.object.isHole){var t=(e.object.geometry.boundingBox.max.x-e.object.geometry.boundingBox.min.x)/2+2,o=(e.object.geometry.boundingBox.max.y-e.object.geometry.boundingBox.min.y)/2-.3;"front"==e.object.wall||"back"==e.object.wall?(e.object.position.z=O.length/2+.05,"back"==e.object.wall&&(e.object.position.z=-O.length/2-.05),e.object.position.x>O.width/2-t?e.object.position.x=O.width/2-t:e.object.position.x<-O.width/2+t&&(e.object.position.x=-O.width/2+t),e.object.position.y>O.height-o?e.object.position.y=O.height-o:e.object.position.y<o&&(e.object.position.y=o)):"left"!=e.object.wall&&"right"!=e.object.wall||(e.object.position.x=-O.width/2-.05,"right"==e.object.wall&&(e.object.position.x=O.width/2+.05),e.object.position.z>O.length/2-t?e.object.position.z=O.length/2-t:e.object.position.z<-O.length/2+t&&(e.object.position.z=-O.length/2+t),e.object.position.y>O.height-o?e.object.position.y=O.height-o:e.object.position.y<o&&(e.object.position.y=o))}else e.object.position.y=0}),v()},e.state=O,Object.defineProperty(e,"__esModule",{value:!0})});